$(".admin-branch>a").on("click",function(){location.href="/site/branch?bid="+$(this).attr("bId")});var mModPasswordTmp=$("#cModPwdTmp").html();$("#adminModPwd").on("click",function(){layer.open({type:1,skin:"layui-layer-rim",area:["480px","290px"],shadeClose:true,title:"修改登录密码",content:mModPasswordTmp})});var mModProfileTmp=$("#cModProfileTmp").html();$("#adminModProfile").on("click",function(){layer.open({type:1,skin:"layui-layer-rim",area:["480px","290px"],shadeClose:true,title:"修改公司资料",content:mModProfileTmp})});$(document).on("click","button.modPwd_button",function(){var b=$("#modPwd_curPwd").val();var a=$("#modPwd_newPwd").val();var c=$("#modPwd_newPwd2").val();if(!b.length){layer.msg(gIconAlert+$("#modPwd_curPwd").attr("placeholder"));return}else{if(!a.length){layer.msg(gIconAlert+$("#modPwd_newPwd").attr("placeholder"));return}else{if(a.length<6){layer.msg(gIconAlert+"登录密码不能小于6位!");$("#modPwd_newPwd").focus();return}else{if(!c.length){layer.msg(gIconAlert+$("#modPwd_newPwd2").attr("placeholder"));return}else{if(a!=c){layer.msg(gIconAlert+"两次输入的新登录密码不一样!");$("#modPwd_newPwd2").focus();return}}}}}$.post("/api/admin/user",{tag:"pwd",curPwd:b,newPwd:a},function(d){if(d.code==0){layer.closeAll();layer.msg(d.msg);setTimeout(function(){location.href="/site/login"},1000)}else{layer.msg(gIconAlert+d.msg)}},"json")});$(document).on("click","button.modProfile_btn",function(){var f=$("#modProfile_name");var e=$("#modProfile_fullname");var d=$("#modProfile_phone");var c=$.trim(f.val());var b=$.trim(e.val());var a=$.trim(d.val());if(!c.length){layer.msg(gIconAlert+f.attr("placeholder"));return}else{if(!b.length){layer.msg(gIconAlert+e.attr("placeholder"));return}else{if(!a.length){layer.msg(gIconAlert+d.attr("placeholder"));return}}}$.post("/api/system/branch",{tag:"modify",name:c,fullname:b,phone:a},function(g){if(g.code==0){layer.closeAll();layer.msg(gIconOK+g.msg);setTimeout(function(){location.reload()},600)}else{layer.msg(gIconOK+g.msg)}},"json")});$(document).on("focus",".my-date-input",function(){var a=$(this);a.attr("autocomplete","off");var e=a.attr("max-date");var c=a.attr("min-date");var b=a.attr("date-fmt");if(!b||b.length==0){b="yyyy-MM-dd"}var d={dateFmt:b};if(e&&e.length>0){d.maxDate=e}if(c&&c.length>0){d.minDate=c}WdatePicker(d)});function checkMobile(b){var a=/^1\d{10}$/;return a.test(b)}function resetLeftMenuScroll(){if($(window).width()<700){return}var f=0;var e=$("#side-menu");var a=e.find("a.nav-top-menu");var d=a.get(0).offsetHeight;f+=d*a.length;var c=10;$.each(e.find("ul.nav-second-level"),function(){var h=$(this).find("li").length;if(h>c){c=h}});var g=32;if(e.find("a.cur-sub-nav").length){g=e.find("a.cur-sub-nav").get(0).offsetHeight}var b=(f+g*c);console.log(b);$("#treeScroller").css({height:b});new IScroll("#nav-left-menus",{mouseWheel:true,click:false})}function rollNumbers(){var a={useEasing:false,useGrouping:false,separator:"",decimal:".",prefix:"",suffix:""};$.each($(".large[data-val]"),function(){var c=$(this);var b=c.attr("data-val");var d=new CountUp(c.get(0),0,b,0,1.5,a);d.start()})}var mAdminWXMSG=$(".admin_wxmsg");var mAdminWXMSG_unread=$(".admin_wxmsg_unread");var mAdminWXMSG_tmp=$("#admin_wxmsg_tpl").html();var mAdminTODO=$(".admin_todo");var mAdminTODO_tmp=$("#admin_todo_tpl").html();var mAdminInfoId=$("#adminInfo_Id").val();function checkNotice(){if(!mAdminTODO.length){return}$.post("/api/admin/notice",{tag:"check",id:mAdminInfoId},function(a){if(a.code==0){console.log("checkNotice -- ");if(a.data.todo&&mAdminTODO.length){mAdminTODO.html(Mustache.render(mAdminTODO_tmp,{items:a.data.todo}))}if(a.data.wxmsg&&mAdminWXMSG.length){mAdminWXMSG.html(Mustache.render(mAdminWXMSG_tmp,{items:a.data.wxmsg}));if(!!a.data.wxmsg_unread){mAdminWXMSG_unread.addClass("unread")}else{mAdminWXMSG_unread.removeClass("unread")}}}},"json")}function bpbPopupImage(d,a){var c='<div class="w-show"><img class="w-image-big" src="{[src]}" alt="">{[#title]}<p class="title">{[title]}</p>{[/title]}</div>';var e={src:d,title:""};if(a){e.title=a}var b=Mustache.render(c,e);layer.open({type:1,title:false,area:["400px","400px"],shadeClose:1,content:b})}$(document).ready(function(){resetLeftMenuScroll();setTimeout(function(){rollNumbers()},200);if(mAdminTODO.length>0){setInterval(checkNotice,180*1000)}});